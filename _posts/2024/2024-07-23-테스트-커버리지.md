---
title: Jacocoμ™€ Gradleμ„ μ‚¬μ©ν• ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ μ„¤μ •
categories: [ "Java & Spring" ]
tags: [ test, jacoco ]
date: 2024-07-23
---

μ‘μ„±ν• ν…μ¤νΈκ°€ μ–΄λ””κΉμ§€ λ΅μ§μ„ μ–Όλ§λ‚ μ»¤λ²„ ν•λ”μ§€ μ§€ν‘λ¥Ό λ³΄μ—¬μ£Όλ” κ²ƒμ„ ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ λΌκ³  ν•©λ‹λ‹¤.
μ„¤μ •ν• ν…μ¤νΈ μ»¤λ²„μ§€λ¦¬λ¥Ό λ„μ§€ λ»ν•λ©΄ λΉλ“μ— μ‹¤ν¨ν•κ² λ§λ“¦μΌλ΅μ¨ ν…μ¤νΈ μ‘μ„±μ— κ°•μ μ„±μ„ λ¶€μ—¬ν•  μ μμµλ‹λ‹¤.

μλ°” μ§„μμ—λ” **Jacoco** λΌμ΄λΈλ¬λ¦¬λ¥Ό μ΄μ©ν•λ©΄ μ‰½κ² ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€λ¥Ό ν™•μΈ ν•  μ μμµλ‹λ‹¤.

# μ „μ²΄ μ½”λ“

- **build.gradle**

```groovy
plugins {
  id 'java'
  id 'org.springframework.boot' version '3.2.3'
  id 'io.spring.dependency-management' version '1.1.4'
  id 'jacoco' // μ¶”κ°€
}

group = 'com.abcdejoji'
version = '0.0.1-SNAPSHOT'

java {
  sourceCompatibility = '21'
}

repositories {
  mavenCentral()
}

dependencies {
  ...
}

jacoco { // μ¶”κ°€
  toolVersion = '0.8.11'
}

test {
  useJUnitPlatform()
}

jacocoTestReport { // μ¶”κ°€
  dependsOn 'test'

  reports {
    html.required = true
    xml.required = false
    csv.required = false
  }

  def qTypes = []
  for (qPattern in "**/entity/QA".."**/entity/QZ") {
    qTypes.add(qPattern + "*")
  }

  afterEvaluate {
    classDirectories.setFrom(files(classDirectories.files.collect {
      fileTree(
        dir: it,
        exclude: ["com/abcdejoji/**/*Application*"] + qTypes
      )
    }))
  }
}

jacocoTestCoverageVerification { // μ¶”κ°€
  dependsOn 'jacocoTestCoverageVerification'

  def qTypes = []
  for (qPattern in '*.entity.QA'..'*.entity.QZ') {
    qTypes.add(qPattern + '*')
  }

  violationRules {
    rule {
      enabled = true
      element = 'CLASS'

      limit {
        counter = 'LINE'
        value = 'COVEREDRATIO'
        minimum = 1
      }

      limit {
        counter = 'BRANCH'
        value = 'COVEREDRATIO'
        minimum = 1
      }

      limit {
        counter = 'LINE'
        value = 'TOTALCOUNT'
        maximum = 150
      }

      excludes = ["**.*Application*"] + qTypes
    }
  }
}

```

# μμ„Έν μ•μ•„λ³΄κΈ°

> `dependsOn`μ€ ν•΄λ‹Ή νƒμ¤ν¬κ°€ μ‹¤ν–‰λκΈ° μ „μ— μ‹¤ν–‰ ν•  νƒμ¤ν¬λ¥Ό μ§€μ •ν•©λ‹λ‹¤.

## plugins

```groovy
plugins {
  id 'jacoco'
}

```

λΉλ“ κ³Όμ •μ—  **jacoco**, **jacocoTestReport**, **jacocoTestCoverageVerification** νƒμ¤ν¬λ¥Ό μΈμ‹ν•  μ μλ„λ΅ ν•΄μ¤λ‹λ‹¤.

## jacoco

```groovy
jacoco {
  toolVersion = '0.8.11'
}

```

JDK λ²„μ „μ— νΈν™λλ” λ²„μ „μΌλ΅ μ„¤μ •ν•λ©΄ λ©λ‹λ‹¤.
μ €λ” μ‘μ„±ν•λ” μ‹μ μ— JDK 21μ„ μ‚¬μ©μ¤‘μ΄κΈ°μ— 0.8.11λ΅ μ„¤μ •ν•μ€μµλ‹λ‹¤.

> **π’΅ νΈν™ λλ” λ²„μ „ ν™•μΈ**
>
> https://www.jacoco.org/jacoco/trunk/doc/changes.html

## jacocoTestReport

```groovy
jacocoTestReport {
  dependsOn 'test'

  reports {
    html.required = true
    xml.required = false
    csv.required = false
  }
}

```

λ¦¬ν¬νΈλ¥Ό μ–΄λ–¤ ν•μ‹μΌλ΅ μƒμ„±ν• μ§€ μ§€μ •ν•©λ‹λ‹¤. μ €λ” HTMLλ§ μƒμ„±λλ„λ΅ ν•μ€μµλ‹λ‹¤.

### λ¦¬ν¬νΈμ—μ„ μ μ™Έ

```groovy
jacocoTestReport {
  ...

  afterEvaluate {
    classDirectories.setFrom(files(classDirectories.files.collect {
      fileTree(
        dir: it,
        exclude: ["com/abcdejoji/**/*Application*"]
      )
    }))
  }
}

```

μ μ™Έμ‹ν‚¬ νμΌμ κ²½λ΅λ¥Ό μ μ–΄μ£Όλ©΄ λ©λ‹λ‹¤. μ™€μΌλ“ μΉ΄λ“ μ‚¬μ©μ΄ κ°€λ¥ν•©λ‹λ‹¤.

## jacocoTestCoverageVerification

```groovy
jacocoTestCoverageVerification {
  dependsOn 'jacocoTestCoverageVerification'

  violationRules {
    rule {
      enabled = true
      element = 'CLASS'

      // includes = []

      limit {
        counter = 'LINE'
        value = 'COVEREDRATIO'
        minimum = 1
      }

      limit {
        counter = 'BRANCH'
        value = 'COVEREDRATIO'
        minimum = 1
      }

      limit {
        counter = 'LINE'
        value = 'TOTALCOUNT'
        maximum = 150
      }

      excludes = ["**.*Application*"]
    }
  }
}

```

- **enable**: ruleμ ν™μ„±ν™” μ—¬λ¶€
- **element**: μ»¤λ²„λ¦¬μ§€λ¥Ό μ²΄ν¬ν•  κΈ°μ¤€ μ„¤μ •
  - BUNDLE: ν¨ν‚¤μ§€ λ²λ“¤
  - CLASS: ν΄λμ¤
  - GROUP: λ…Όλ¦¬μ  λ²λ“¤ κ·Έλ£Ή
  - METHOD: λ©”μ†λ“
  - PACKAGE: ν¨ν‚¤μ§€
  - SOURCEFILE: μ†μ¤ νμΌ
  - Default: BUNDLE
- **includes**
  - ruleμ μ μ© λ€μƒμ„ package μμ¤€μΌλ΅ μ •μ
  - Default: μ „μ²΄ Package
- **limit**: μ»¤λ²„λ¦¬μ§€ μΈ΅μ • λ‹¨μ„ μ§€μ •
  - **counter**: μ»¤λ²„λ¦¬μ§€ μΈ΅μ •μ μµμ† λ‹¨μ„
    - LINE: λΉ μ¤„μ„ μ μ™Έν• μ‹¤μ  μ½”λ“μ λΌμΈ μ, λΌμΈμ΄ ν• λ²μ΄λΌλ„ μ‹¤ν–‰λλ©΄ μ‹¤ν–‰λ κ²ƒμΌλ΅ κ°„μ£Ό
    - BRANCH: μ΅°κ±΄λ¬Έ λ“±μ λ¶„κΈ° μ
    - CLASS: ν΄λμ¤ μ, λ‚΄λ¶€ λ©”μ†λ“κ°€ ν• λ²μ΄λΌλ„ μ‹¤ν–‰λλ‹¤λ©΄ μ‹¤ν–‰λ κ²ƒμΌλ΅ κ°„μ£Ό
    - COMPLEXITY: λ³µμ΅λ„
    - INSTRUCTION: Java λ°”μ΄νΈ μ½”λ“ λ…λ Ή μ
    - METHOD: λ©”μ†λ“ μ, λ©”μ†λ“κ°€ ν• λ²μ΄λΌλ„ μ‹¤ν–‰ λλ‹¤λ©΄ μ‹¤ν–‰λ κ²ƒμΌλ΅ κ°„μ£Ό
    - Default: INSTRUCTION
  - **value**: μΈ΅μ •ν• μ»¤λ²„λ¦¬μ§€λ¥Ό μ–΄λ–¤ ν•μ‹μΌλ΅ λ³΄μ—¬μ¤„ κ²ƒμΈμ§€λ¥Ό μλ―Έ
    - COVEREDRATIO: μ»¤λ²„λ λΉ„μ¨. 0: 0%, 1: 100%
    - COVEREDCOUNT: μ»¤λ²„λ κ°μ
    - MISSEDCOUNT: μ»¤λ²„λμ§€ μ•μ€ κ°μ
    - MISSEDRATIO: μ»¤λ²„λμ§€ μ•μ€ λΉ„μ¨. 0: 0%, 1: 100%
    - TOTALCOUNT: μ „μ²΄ κ°μ
    - Default: COVEREDRATIO
  - **minimum**: counter κ°’μ„ valueμ— λ§κ² ν‘ν„ν–μ„ λ• μµμ†κ°’μ„ μλ―Έ
    - μ΄ κ°’μΌλ΅ jacocoTestCoverageVerificationμ μ„±κ³µ μ—¬λ¶€κ°€ κ²°μ •
- **excludes**: μ μ™Έν•  ν΄λμ¤ μ§€μ •
  - `ν¨ν‚¤μ§€ + ν΄λμ¤λ…` μΌλ΅ μ‘μ„±λλ©° , `?`λ¥Ό μ‚¬μ© κ°€λ¥

## νΉμ • λ©”μ†λ“ μ»¤λ²„λ¦¬μ§€ μ μ™Έ

> λ©”μ†λ“ μ μ™Έ μ΄μ
> Lombokμ„ μ‚¬μ©ν•μ§€ μ•κ³  ν”„λ΅μ νΈλ¥Ό μ§„ν–‰ ν•λ μ¤‘ μƒμ„±μ, equals, hashCodeλ¥Ό μ»¤λ²„λ¦¬μ§€μ—μ„ μ μ™Έν•λ ¤ ν•μ€μΌλ‚ excludesμ— μ•„λ¬΄λ¦¬ μ¶”κ°€ν•΄λ„ μ μ™Έλμ§€ μ•μ•μµλ‹λ‹¤.
>
> μ°Ύμ•„λ³΄λ‹ `element = 'CLASS'`λ΅ μ„¤μ •ν•λ©΄ μ μ™Έ κ°€λ¥ν• μμ¤€λ„ ν΄λμ¤λ΅ λμ–΄ λ©”μ†λ“ λ‹¨μ„λ” μ μ™Έκ°€ μ•λλ‹¤κ³  ν•©λ‹λ‹¤.

> jacoco 0.8.2 λ¶€ν„°λ” μ–΄λ…Έν…μ΄μ…μ„ λ§λ“¤μ–΄ λ©”μ†λ“λ¥Ό μ μ™Έ μ‹ν‚¬ μ μκ² λμ—μµλ‹λ‹¤.

**μ–΄λ…Έν…μ΄μ… μ΅°κ±΄**

- Retention: λ°νƒ€μ„ or ν΄λμ¤
- μ΄λ¦„μ— **Generated**μ΄ ν¬ν•¨

```java

@Retention(RetentionPolicy.RUNTIME)
@Target({METHOD, CONSTRUCTOR})
public @interface ExcludeTestGenerated {
}

```

μ €λ” λ…λ°±ν **ν…μ¤νΈμ—μ„ μ μ™Έν•λ‹¤ λΌλ” μλ―Έ**λ¥Ό μ£Όκ³  μ‹¶μ–΄ μ„μ™€ κ°™μ΄ λ§λ“¤μ–΄ μ‚¬μ© μ¤‘μ…λ‹λ‹¤.

```java

@ExcludeTestGenerated
public CreatePostService(SavePostPort savePostPort) {
  this.savePostPort = savePostPort;
}

```

μ„ μ²λΌ μ μ™Έν•  μƒμ„±μλ‚ λ©”μ†λ“μ— μ–΄λ…Έν…μ΄μ…μ„ μ¶”κ°€ν•λ©΄ ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ μΈ΅μ •μ—μ„ μ μ™Έλ©λ‹λ‹¤.

## Lombok ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ μ μ™Έ

Lombokμ„ μ‚¬μ©ν•μ—¬ μƒμ„±λ λ¶€λ¶„λ“¤ λ§μ € λ¨λ‘ ν…μ¤νΈν•κΈ°μ—λ” λΉ„ν¨μ¨μ μ΄λΌ μƒκ°ν•κΈ°μ— Lombokμ„ μ‚¬μ©ν• λ¶€λ¶„μ€ λ¨λ‘ ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ μΈ΅μ •μ—μ„ μ μ™Έν•λ„λ΅ μ„¤μ •ν•κ² μµλ‹λ‹¤.

> lombok.config

```
lombok.addLombokGeneratedAnnotation = true
```

## QueryDSL μ‚¬μ© μ‹, Q-Type ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ μ μ™Έ

> QueryDSL μ§§λ§‰ν• μ§€μ‹
> Javaλ¥Ό μ‚¬μ©ν•΄μ„ κ°λ°μ„ ν•λ©΄ ORMμΌλ΅ λ³΄ν†µ JPAλ¥Ό λ§μ΄ μ‚¬μ©ν•©λ‹λ‹¤.
>
> μ—¬κΈ°μ„ JPAλ¥Ό **Type-Safe**ν•κ² μ‘μ„±ν•λ©° **λ™μ  μΏΌλ¦¬**λ„ κ°„λ‹¨ν•κ² λ§λ“¤ μ μλ” QueryDSLμ„ μ–Ήμ–΄ μ‚¬μ©ν•κ² λλ”λ°
> QueryDSLμ€ **@Entity**κ°€ λ¶™μ€ ν΄λμ¤λ¥Ό μ°Ύμ•„ **Q-Type**μ„ μƒμ„±ν•©λ‹λ‹¤.
>
> μ΄ **Q-Type**μ„ ν†µν•΄ μΏΌλ¦¬λ¥Ό μ‘μ„±ν•κ² λ©λ‹λ‹¤.

### jacocoTestCoverageVerification

```groovy
jacocoTestCoverageVerification {
  dependsOn 'jacocoTestCoverageVerification'

  def qTypes = []
  for (qPattern in '*.entity.QA'..'*.entity.QZ') {
    qTypes.add(qPattern + '*')
  }

  violationRules {
    rule {
      enabled = true
      element = 'CLASS'

      // includes = []

      limit {
        counter = 'LINE'
        value = 'COVEREDRATIO'
        minimum = 1
      }

      limit {
        counter = 'BRANCH'
        value = 'COVEREDRATIO'
        minimum = 1
      }

      limit {
        counter = 'LINE'
        value = 'TOTALCOUNT'
        maximum = 150
      }

      excludes = ["**.*Application*"] + qTypes
    }
  }
}

```

λ¨λ“  **Q-Type**μ€ **Q + Entity ν΄λμ¤λ…**μ΄κΈ° λ•λ¬Έμ— **QA ~ QZ**λ΅ μ‹μ‘ν•λ” λ¨λ“  ν΄λμ¤λ¥Ό λ€μƒμ—μ„ μ μ™Έ μ‹μΌ°μµλ‹λ‹¤.

μ €λ” **entity ν¨ν‚¤μ§€** μ•μ— λ„£μ–΄μ„ μ‘μ„±ν•  μμ •μ΄λΌ **entity ν¨ν‚¤μ§€**λ„ μ μ—μ§€λ§ **\*.QA**μ²λΌλ§ μ‘μ„±ν•΄λ„ λ©λ‹λ‹¤.
μ΄λ ‡κ² λ§λ“  μ μ™Έ ν΄λμ¤λ¥Ό **excludes**μ— μ¶”κ°€ν•λ©΄ λ©λ‹λ‹¤.

> QNAμ™€ κ°™μ€ μ—”ν‹°ν‹° μ΄μ
> QNAκ°™μ€ Entityλ…μΌλ΅ μ‘μ„± μ‹ λ‹Ήμ—°ν ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€μ—μ„ μ μ™Έ λ©λ‹λ‹¤. μ΄ κ²½μ°λ” νΉλ³„ν Qna μ²λΌ μ΅°κΈ λ‹¤λ¥Έ λ°©μ‹μ΄λ‚ λ„¤μ΄λ°μΌλ΅ μƒμ„±ν•΄ μ£Όμ‹κΈ° λ°”λλ‹λ‹¤.

### jacocoTestReport

```groovy
jacocoTestReport {
  ...

  def qTypes = []
  for (qPattern in "**/entity/QA".."**/entity/QZ") {
    qTypes.add(qPattern + "*")
  }

  afterEvaluate {
    classDirectories.setFrom(files(classDirectories.files.collect {
      fileTree(
        dir: it,
        exclude: ["com/abcdejoji/**/*Application*"] + qTypes
      )
    }))
  }
}

```

ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€μ—μ„ μ μ™Έ μ‹ν‚¤λ” κ²ƒκ³Όλ” λ‹¤λ¥΄κ² μ—¬κΈ°μ„λ” **ν΄λ” κ²½λ΅λ΅ μ§€μ •**μ„ ν•΄μ£Όμ–΄μ•Ό ν•©λ‹λ‹¤.
μ΄μ  λ‹¤μ‹ μ‹¤ν–‰ν•κ³  λ¦¬ν¬νΈλ¥Ό λ³΄λ©΄ **Q-Typeμ€ λ”μ΄μƒ λ‚μ¤μ§€ μ•λ” κ²ƒμ„ ν™•μΈ** ν•  μ μμµλ‹λ‹¤.
