---
title: Jacocoì™€ Gradleì„ ì‚¬ìš©í•œ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì„¤ì •
categories: [ Java & Spring ]
tag: [ test, jacoco ]
date: 2024-07-23
---

ì‘ì„±í•œ í…ŒìŠ¤íŠ¸ê°€ ì–´ë””ê¹Œì§€ ë¡œì§ì„ ì–¼ë§ˆë‚˜ ì»¤ë²„ í•˜ëŠ”ì§€ ì§€í‘œë¥¼ ë³´ì—¬ì£¼ëŠ” ê²ƒì„ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ë¼ê³  í•©ë‹ˆë‹¤.
ì„¤ì •í•œ í…ŒìŠ¤íŠ¸ ì»¤ë²„ì§€ë¦¬ë¥¼ ë„˜ì§€ ëª»í•˜ë©´ ë¹Œë“œì— ì‹¤íŒ¨í•˜ê²Œ ë§Œë“¦ìœ¼ë¡œì¨ í…ŒìŠ¤íŠ¸ ì‘ì„±ì— ê°•ì œì„±ì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìë°” ì§„ì˜ì—ëŠ” **Jacoco** ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ë©´ ì‰½ê²Œ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

# ì „ì²´ ì½”ë“œ

- **build.gradle**

```groovy
plugins {
  id 'java'
  id 'org.springframework.boot' version '3.2.3'
  id 'io.spring.dependency-management' version '1.1.4'
  id 'jacoco' // ì¶”ê°€
}

group = 'com.abcdejoji'
version = '0.0.1-SNAPSHOT'

java {
  sourceCompatibility = '21'
}

repositories {
  mavenCentral()
}

dependencies {
  ...
}

jacoco { // ì¶”ê°€
  toolVersion = '0.8.11'
}

test {
  useJUnitPlatform()
}

jacocoTestReport { // ì¶”ê°€
  dependsOn 'test'

  reports {
    html.required = true
    xml.required = false
    csv.required = false
  }

  def qTypes = []
  for (qPattern in "**/entity/QA".."**/entity/QZ") {
    qTypes.add(qPattern + "*")
  }

  afterEvaluate {
    classDirectories.setFrom(files(classDirectories.files.collect {
      fileTree(
        dir: it,
        exclude: ["com/abcdejoji/**/*Application*"] + qTypes
      )
    }))
  }
}

jacocoTestCoverageVerification { // ì¶”ê°€
  dependsOn 'jacocoTestCoverageVerification'

  def qTypes = []
  for (qPattern in '*.entity.QA'..'*.entity.QZ') {
    qTypes.add(qPattern + '*')
  }

  violationRules {
    rule {
      enabled = true
      element = 'CLASS'

      limit {
        counter = 'LINE'
        value = 'COVEREDRATIO'
        minimum = 1
      }

      limit {
        counter = 'BRANCH'
        value = 'COVEREDRATIO'
        minimum = 1
      }

      limit {
        counter = 'LINE'
        value = 'TOTALCOUNT'
        maximum = 150
      }

      excludes = ["**.*Application*"] + qTypes
    }
  }
}

```

# ìì„¸íˆ ì•Œì•„ë³´ê¸°

<aside>
ğŸ’¡

dependsOnì€ í•´ë‹¹ íƒœìŠ¤í¬ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ì‹¤í–‰ í•  íƒœìŠ¤í¬ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.

</aside>

## plugins

```groovy
plugins {
  id 'jacoco'
}

```

ë¹Œë“œ ê³¼ì •ì—  **jacoco**, **jacocoTestReport**, **jacocoTestCoverageVerification** íƒœìŠ¤í¬ë¥¼ ì¸ì‹í•  ìˆ˜ ìˆë„ë¡ í•´ì¤ë‹ˆë‹¤.

## jacoco

```groovy
jacoco {
  toolVersion = '0.8.11'
}

```

JDK ë²„ì „ì— í˜¸í™˜ë˜ëŠ” ë²„ì „ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ë©ë‹ˆë‹¤.
ì €ëŠ” ì‘ì„±í•˜ëŠ” ì‹œì ì— JDK 21ì„ ì‚¬ìš©ì¤‘ì´ê¸°ì— 0.8.11ë¡œ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤.

> **í˜¸í™˜ ë˜ëŠ” ë²„ì „ í™•ì¸**  
> https://www.jacoco.org/jacoco/trunk/doc/changes.html

## jacocoTestReport

```groovy
jacocoTestReport {
  dependsOn 'test'

  reports {
    html.required = true
    xml.required = false
    csv.required = false
  }
}

```

ë¦¬í¬íŠ¸ë¥¼ ì–´ë–¤ í˜•ì‹ìœ¼ë¡œ ìƒì„±í• ì§€ ì§€ì •í•©ë‹ˆë‹¤. ì €ëŠ” HTMLë§Œ ìƒì„±ë˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

### ë¦¬í¬íŠ¸ì—ì„œ ì œì™¸

```groovy
jacocoTestReport {
  ...

  afterEvaluate {
    classDirectories.setFrom(files(classDirectories.files.collect {
      fileTree(
        dir: it,
        exclude: ["com/abcdejoji/**/*Application*"]
      )
    }))
  }
}

```

ì œì™¸ì‹œí‚¬ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì ì–´ì£¼ë©´ ë©ë‹ˆë‹¤. ì™€ì¼ë“œ ì¹´ë“œ ì‚¬ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## jacocoTestCoverageVerification

```groovy
jacocoTestCoverageVerification {
  dependsOn 'jacocoTestCoverageVerification'

  violationRules {
    rule {
      enabled = true
      element = 'CLASS'

      // includes = []

      limit {
        counter = 'LINE'
        value = 'COVEREDRATIO'
        minimum = 1
      }

      limit {
        counter = 'BRANCH'
        value = 'COVEREDRATIO'
        minimum = 1
      }

      limit {
        counter = 'LINE'
        value = 'TOTALCOUNT'
        maximum = 150
      }

      excludes = ["**.*Application*"]
    }
  }
}

```

- **enable**: ruleì˜ í™œì„±í™” ì—¬ë¶€
- **element**: ì»¤ë²„ë¦¬ì§€ë¥¼ ì²´í¬í•  ê¸°ì¤€ ì„¤ì •
  - BUNDLE: íŒ¨í‚¤ì§€ ë²ˆë“¤
  - CLASS: í´ë˜ìŠ¤
  - GROUP: ë…¼ë¦¬ì  ë²ˆë“¤ ê·¸ë£¹
  - METHOD: ë©”ì†Œë“œ
  - PACKAGE: íŒ¨í‚¤ì§€
  - SOURCEFILE: ì†ŒìŠ¤ íŒŒì¼
  - Default: BUNDLE
- **includes**
  - ruleì˜ ì ìš© ëŒ€ìƒì„ package ìˆ˜ì¤€ìœ¼ë¡œ ì •ì˜
  - Default: ì „ì²´ Package
- **limit**: ì»¤ë²„ë¦¬ì§€ ì¸¡ì • ë‹¨ìœ„ ì§€ì •
  - **counter**: ì»¤ë²„ë¦¬ì§€ ì¸¡ì •ì˜ ìµœì†Œ ë‹¨ìœ„
    - LINE: ë¹ˆ ì¤„ì„ ì œì™¸í•œ ì‹¤ì œ ì½”ë“œì˜ ë¼ì¸ ìˆ˜, ë¼ì¸ì´ í•œ ë²ˆì´ë¼ë„ ì‹¤í–‰ë˜ë©´ ì‹¤í–‰ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼
    - BRANCH: ì¡°ê±´ë¬¸ ë“±ì˜ ë¶„ê¸° ìˆ˜
    - CLASS: í´ë˜ìŠ¤ ìˆ˜, ë‚´ë¶€ ë©”ì†Œë“œê°€ í•œ ë²ˆì´ë¼ë„ ì‹¤í–‰ëœë‹¤ë©´ ì‹¤í–‰ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼
    - COMPLEXITY: ë³µì¡ë„
    - INSTRUCTION: Java ë°”ì´íŠ¸ ì½”ë“œ ëª…ë ¹ ìˆ˜
    - METHOD: ë©”ì†Œë“œ ìˆ˜, ë©”ì†Œë“œê°€ í•œ ë²ˆì´ë¼ë„ ì‹¤í–‰ ëœë‹¤ë©´ ì‹¤í–‰ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼
    - Default: INSTRUCTION
  - **value**: ì¸¡ì •í•œ ì»¤ë²„ë¦¬ì§€ë¥¼ ì–´ë–¤ í˜•ì‹ìœ¼ë¡œ ë³´ì—¬ì¤„ ê²ƒì¸ì§€ë¥¼ ì˜ë¯¸
    - COVEREDRATIO: ì»¤ë²„ëœ ë¹„ìœ¨. 0: 0%, 1: 100%
    - COVEREDCOUNT: ì»¤ë²„ëœ ê°œìˆ˜
    - MISSEDCOUNT: ì»¤ë²„ë˜ì§€ ì•Šì€ ê°œìˆ˜
    - MISSEDRATIO: ì»¤ë²„ë˜ì§€ ì•Šì€ ë¹„ìœ¨. 0: 0%, 1: 100%
    - TOTALCOUNT: ì „ì²´ ê°œìˆ˜
    - Default: COVEREDRATIO
  - **minimum**: counter ê°’ì„ valueì— ë§ê²Œ í‘œí˜„í–ˆì„ ë•Œ ìµœì†Ÿê°’ì„ ì˜ë¯¸
    - ì´ ê°’ìœ¼ë¡œ jacocoTestCoverageVerificationì˜ ì„±ê³µ ì—¬ë¶€ê°€ ê²°ì •
- **excludes**: ì œì™¸í•  í´ë˜ìŠ¤ ì§€ì •
  - `íŒ¨í‚¤ì§€ + í´ë˜ìŠ¤ëª…` ìœ¼ë¡œ ì‘ì„±ë˜ë©° , `?`ë¥¼ ì‚¬ìš© ê°€ëŠ¥

## íŠ¹ì • ë©”ì†Œë“œ ì»¤ë²„ë¦¬ì§€ ì œì™¸

> ë©”ì†Œë“œ ì œì™¸ ì´ìŠˆ
> Lombokì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰ í•˜ë˜ ì¤‘ ìƒì„±ì, equals, hashCodeë¥¼ ì»¤ë²„ë¦¬ì§€ì—ì„œ ì œì™¸í•˜ë ¤ í•˜ì˜€ìœ¼ë‚˜ excludesì— ì•„ë¬´ë¦¬ ì¶”ê°€í•´ë„ ì œì™¸ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
>
> ì°¾ì•„ë³´ë‹ˆ `element = 'CLASS'`ë¡œ ì„¤ì •í•˜ë©´ ì œì™¸ ê°€ëŠ¥í•œ ìˆ˜ì¤€ë„ í´ë˜ìŠ¤ë¡œ ë˜ì–´ ë©”ì†Œë“œ ë‹¨ìœ„ëŠ” ì œì™¸ê°€ ì•ˆëœë‹¤ê³  í•©ë‹ˆë‹¤.

> jacoco 0.8.2 ë¶€í„°ëŠ” ì–´ë…¸í…Œì´ì…˜ì„ ë§Œë“¤ì–´ ë©”ì†Œë“œë¥¼ ì œì™¸ ì‹œí‚¬ ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

**ì–´ë…¸í…Œì´ì…˜ ì¡°ê±´**

- Retention: ëŸ°íƒ€ì„ or í´ë˜ìŠ¤
- ì´ë¦„ì— **Generated**ì´ í¬í•¨

```java

@Retention(RetentionPolicy.RUNTIME)
@Target({METHOD, CONSTRUCTOR})
public @interface ExcludeTestGenerated {
}

```

ì €ëŠ” ëª…ë°±íˆ **í…ŒìŠ¤íŠ¸ì—ì„œ ì œì™¸í•œë‹¤ ë¼ëŠ” ì˜ë¯¸**ë¥¼ ì£¼ê³  ì‹¶ì–´ ìœ„ì™€ ê°™ì´ ë§Œë“¤ì–´ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤.

```java

@ExcludeTestGenerated
public CreatePostService(SavePostPort savePostPort) {
  this.savePostPort = savePostPort;
}

```

ìœ„ ì²˜ëŸ¼ ì œì™¸í•  ìƒì„±ìë‚˜ ë©”ì†Œë“œì— ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•˜ë©´ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì¸¡ì •ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.

## Lombok í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì œì™¸

Lombokì„ ì‚¬ìš©í•˜ì—¬ ìƒì„±ëœ ë¶€ë¶„ë“¤ ë§ˆì € ëª¨ë‘ í…ŒìŠ¤íŠ¸í•˜ê¸°ì—ëŠ” ë¹„íš¨ìœ¨ì ì´ë¼ ìƒê°í•˜ê¸°ì— Lombokì„ ì‚¬ìš©í•œ ë¶€ë¶„ì€ ëª¨ë‘ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì¸¡ì •ì—ì„œ ì œì™¸í•˜ë„ë¡ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.

> lombok.config
>

```
lombok.addLombokGeneratedAnnotation = true

```

## QueryDSL ì‚¬ìš© ì‹œ, Q-Type í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì œì™¸

> QueryDSL ì§§ë§‰í•œ ì§€ì‹
> Javaë¥¼ ì‚¬ìš©í•´ì„œ ê°œë°œì„ í•˜ë©´ ORMìœ¼ë¡œ ë³´í†µ JPAë¥¼ ë§ì´ ì‚¬ìš©í•©ë‹ˆë‹¤.
>
> ì—¬ê¸°ì„œ JPAë¥¼ **Type-Safe**í•˜ê²Œ ì‘ì„±í•˜ë©° **ë™ì  ì¿¼ë¦¬**ë„ ê°„ë‹¨í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆëŠ” QueryDSLì„ ì–¹ì–´ ì‚¬ìš©í•˜ê²Œ ë˜ëŠ”ë°
> QueryDSLì€ **@Entity**ê°€ ë¶™ì€ í´ë˜ìŠ¤ë¥¼ ì°¾ì•„ **Q-Type**ì„ ìƒì„±í•©ë‹ˆë‹¤.
>
> ì´ **Q-Type**ì„ í†µí•´ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê²Œ ë©ë‹ˆë‹¤.

### jacocoTestCoverageVerification

```groovy
jacocoTestCoverageVerification {
  dependsOn 'jacocoTestCoverageVerification'

  def qTypes = []
  for (qPattern in '*.entity.QA'..'*.entity.QZ') {
    qTypes.add(qPattern + '*')
  }

  violationRules {
    rule {
      enabled = true
      element = 'CLASS'

      // includes = []

      limit {
        counter = 'LINE'
        value = 'COVEREDRATIO'
        minimum = 1
      }

      limit {
        counter = 'BRANCH'
        value = 'COVEREDRATIO'
        minimum = 1
      }

      limit {
        counter = 'LINE'
        value = 'TOTALCOUNT'
        maximum = 150
      }

      excludes = ["**.*Application*"] + qTypes
    }
  }
}

```

ëª¨ë“  **Q-Type**ì€ **Q + Entity í´ë˜ìŠ¤ëª…**ì´ê¸° ë•Œë¬¸ì— **QA ~ QZ**ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  í´ë˜ìŠ¤ë¥¼ ëŒ€ìƒì—ì„œ ì œì™¸ ì‹œì¼°ìŠµë‹ˆë‹¤.

ì €ëŠ” **entity íŒ¨í‚¤ì§€** ì•ˆì— ë„£ì–´ì„œ ì‘ì„±í•  ì˜ˆì •ì´ë¼ **entity íŒ¨í‚¤ì§€**ë„ ì ì—ˆì§€ë§Œ **\*.QA**ì²˜ëŸ¼ë§Œ ì‘ì„±í•´ë„ ë©ë‹ˆë‹¤.
ì´ë ‡ê²Œ ë§Œë“  ì œì™¸ í´ë˜ìŠ¤ë¥¼ **excludes**ì— ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤.

> QNAì™€ ê°™ì€ ì—”í‹°í‹° ì´ìŠˆ
> QNAê°™ì€ Entityëª…ìœ¼ë¡œ ì‘ì„± ì‹œ ë‹¹ì—°íˆ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ì—ì„œ ì œì™¸ ë©ë‹ˆë‹¤. ì´ ê²½ìš°ëŠ” íŠ¹ë³„íˆ Qna ì²˜ëŸ¼ ì¡°ê¸ˆ ë‹¤ë¥¸ ë°©ì‹ì´ë‚˜ ë„¤ì´ë°ìœ¼ë¡œ ìƒì„±í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

### jacocoTestReport

```groovy
jacocoTestReport {
  ...

  def qTypes = []
  for (qPattern in "**/entity/QA".."**/entity/QZ") {
    qTypes.add(qPattern + "*")
  }

  afterEvaluate {
    classDirectories.setFrom(files(classDirectories.files.collect {
      fileTree(
        dir: it,
        exclude: ["com/abcdejoji/**/*Application*"] + qTypes
      )
    }))
  }
}

```

í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ì—ì„œ ì œì™¸ ì‹œí‚¤ëŠ” ê²ƒê³¼ëŠ” ë‹¤ë¥´ê²Œ ì—¬ê¸°ì„œëŠ” **í´ë” ê²½ë¡œë¡œ ì§€ì •**ì„ í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
ì´ì œ ë‹¤ì‹œ ì‹¤í–‰í•˜ê³  ë¦¬í¬íŠ¸ë¥¼ ë³´ë©´ **Q-Typeì€ ë”ì´ìƒ ë‚˜ì˜¤ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸** í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
