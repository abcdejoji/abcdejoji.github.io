---
title: "ë¹ˆ ìŠ¤ì½”í”„"
categories: [ "Java & Spring" ]
tags: [ "[ì¸í”„ëŸ°] ìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬" ]
date: "2025-11-03 01:33:00"
---

## ë¹ˆ ìŠ¤ì½”í”„ë€?

- ë¹ˆì´ ì¡´ì¬í•  ìˆ˜ ìˆëŠ” ë²”ìœ„

### ìŠ¤í”„ë§ì˜ ì§€ì› ìŠ¤ì½”í”„

- `singleton`: ê¸°ë³¸ ìŠ¤ì½”í”„, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹œì‘ê³¼ ì¢…ë£Œê¹Œì§€ ìœ ì§€ë˜ëŠ” ê°€ì¥ ë„“ì€ ë²”ìœ„ì˜ ìŠ¤ì½”í”„
- `prototype`: ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì˜ ìƒì„±ê³¼ ì˜ì¡´ê´€ê³„ ì£¼ì…ê¹Œì§ë‚˜ ê´€ë ¤í•˜ê³  ë”ëŠ” ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ë§¤ìš° ì§§ì€ ë²”ìœ„ì˜ ìŠ¤ì½”í”„
- `request`: ì›¹ ìš”ì²­ì´ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆ ë•Œ ê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„
- `session`: ì›¹ ì„¸ì…˜ì´ ìƒì„±ë˜ê³  ì¢…ë£Œë  ë–„ ê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„
- `application`: ì›¹ ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì™€ ê°™ì€ ë²”ìœ„ë¡œ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„

### ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ìë™ ë“±ë¡

```java

@Scope("prototype")
@Component
public class Bean {
}
```

### ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ìˆ˜ë™ ë“±ë¡

```java

@Scope("prototype")
@Bean
Bean bean() {
  return new Bean();
}
```

## í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„

- ë¹ˆ ìš”ì²­ ì‹œ, ë§¤ë²ˆ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•˜ê³  ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ê´€ë¦¬í•˜ì§€ ì•ŠìŒ
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•˜ê³ , ì˜ì¡´ ê´€ê³„ ì£¼ì…, ì´ˆê¸°í™”ê¹Œì§€ë§Œ ì²˜ë¦¬
- ë”°ë¼ì„œ, `@Predestory` ê°™ì€ ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì§€ ì•ŠìŒ

### ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš© ì‹œ ë¬¸ì œì 

ì‹±ê¸€í†¤ ë¹ˆì—ì„œ í”„ë¡œí† íƒ€ì…ì„ ì˜ì¡´ ì£¼ì… ë°›ì•„ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ì‚¬ìš© í•  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ê°ì²´ì´ê¸¸ ê¸°ëŒ€í•˜ê² ì§€ë§Œ,
ì˜ì¡´ ì£¼ì…ì€ ìƒì„± ì‹œì ì— í•œ ë²ˆ ì£¼ì…ë˜ëŠ” ê²ƒì´ë¯€ë¡œ, ì²˜ìŒ ì£¼ì…ëœ ê°ì²´ê°€ ìœ ì§€ë©ë‹ˆë‹¤.

### ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©ì‹œ Providerë¡œ ë¬¸ì œ í•´ê²°

ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì€ ë§¤ ìš”ì²­ë§ˆë‹¤ `ApplicationContext`ì—ì„œ ë¹ˆì„ ì¡°íšŒí•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

```java
public int logic() {
  // ë§¤ë²ˆ ìƒˆë¡œìš´ prototypeBeanì„ ë°˜í™˜
  PrototypeBean prototypeBean = ac.getBean(PrototypeBean.class);

  prototypeBean.addCount();
  int count = prototypeBean.getCount();
  return count;
}
```

- ì˜ì¡´ ê´€ê³„ë¥¼ ì™¸ë¶€ì—ì„œ ì£¼ì…(`DI`) ë°›ëŠ”ê²Œ ì•„ë‹ˆë¼ ì´ë ‡ê²Œ ì§ì ‘ í•„ìš¯ë€ ì˜ì¡´ ê´€ê³„ë¥¼ ì°¾ëŠ” ê²ƒì„ `Dependency Lookup(DL)` ì˜ì¡´ê´€ê³„ ì¡°íšŒ(íƒìƒ‰)ì´ë¼ í•¨
- ì´ë ‡ê²Œ ìŠ¤í”„ë§ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ ì „ì²´ë¥¼ ì£¼ì…ë°›ê²Œ ë˜ë©´, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì¢…ì†ì ì¸ ì½”ë“œê°€ ë˜ê³  ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë„ ì–´ë ¤ì›Œ ì§
- `DL` ì •ë„ì˜ ê¸°ëŠ¥ë§Œ ì œê³µí•˜ëŠ” `ObjectFactory`, `ObjectProvider`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ ë¬¸ì œë¥¼ í•´ê²°

### ObjectFactory, ObjectProvider

```java

@Autowired
private ObjectProvider<PrototypeBean> prototypeBeanProvider;

public int logic() {
  PrototypeBean prototypeBean = prototypeBeanProvider.getObject();
  prototypeBean.addCount();
  int count = prototypeBean.getCount();
  return count;
}
```

- `ObjectProvider`ì˜ `getObject()`ë¥¼ í˜¸ì¶œí•˜ë©´ ë‚´ë¶€ì—ì„œëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ í•´ë‹¹ ë¹ˆì„ ì°¾ì•„ì„œ ë°˜í™˜(`DL`)
- `ObjectFactory`: ê¸°ëŠ¥ì´ ë‹¨ìˆœ, ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš” ì—†ìŒ, ìŠ¤í”„ë§ì— ì˜ì¡´
- `ObjectProvider`: `ObjectFactory` ìƒì†, ì˜µì…˜, ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬ ë“± í¸ì˜ ê¸°ëŠ¥ì´ ë§ê³ , ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš” ì—†ìŒ, ìŠ¤í”„ë§ì— ì˜ì¡´

### JSR-330 Provider

- **build.gradle**

```groovy
dependencies {
  // ...
  implementation("jakarta.inject:jakarta.inject-api:2.0.1")
}
```

```java

@Autowired
private Provider<PrototypeBean> provider;

public int logic() {
  PrototypeBean prototypeBean = provider.get();
  prototypeBean.addCount();
  int count = prototypeBean.getCount();
  return count;
}
```

- `get()` ë©”ì„œë“œ í•˜ë‚˜ë¡œ ê¸°ëŠ¥ì´ ë§¤ìš° ë‹¨ìˆœ
- ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”
- ìë°” í‘œì¤€ì´ë¯€ë¡œ ìŠ¤í”„ë§ì´ ì•„ë‹Œ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

> ğŸ’¡ ObjectProvider vs JSR-330 Provider
>
> ìŠ¤í”„ë§ì´ ì•„ë‹Œ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•  ìƒí™©ì´ ìˆë‹¤ë©´ `JSR-330 Provider`ë¥¼ ì‚¬ìš©í•˜ë©´ ë˜ì§€ë§Œ,
> ì‚¬ì‹¤ìƒ ê·¸ëŸ´ ì¼ì€ ê±°ì˜ ì—†ê¸° ë•Œë¬¸ì— ìŠ¤í”„ë§ì—ì„œ ì œê³µí•˜ëŠ” `ObjectProvider`ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

## ì›¹ ìŠ¤ì½”í”„

- `request`: HTTP ìš”ì²­ í•˜ë‚˜ê°€ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆ ë–„ ê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„, ê°ê°ìœ¼ HTTP ìš”ì²­ ë§ˆë‹¤ ë³„ë„ì˜ ë¹ˆ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ê³  ê´€ë¦¬ë¨
- `session`: HTTP Sessionê³¼ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„
- `application`: ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì™€ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„
- `websocket`: ì›¹ ì†Œì¼“ê³¼ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„

### request ìŠ¤ì½”í”„ ì˜ˆì œ ë§Œë“¤ê¸°

- ë§¤ ìš”ì²­ ë§ˆë‹¤ ì‚¬ìš©ìë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ìœ„ì™€ ê°™ì´ ë¡œê·¸ê°€ ë‚¨ë„ë¡ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.

```bash
[d06b992f...] request scope bean create
[d06b992f...][http://localhost:8080/log-demo] controller test
[d06b992f...][http://localhost:8080/log-demo] service id = testId
[d06b992f...] request scope bean close
```

- **build.gradle**

```groovy
dependencies {
  // ...
  implementation("org.springframework.boot:spring-boot-starter-web")
}
```

```java

@Component
@Scope(value = "request")
public class MyLogger {

  private String uuid;
  private String requestURL;

  public void setRequestURL(String requestURL) {
    this.requestURL = requestURL;
  }

  public void log(String message) {
    System.out.println("[" + uuid + "] " + "[" + requestURL + "] " + message);
  }

  @PostConstruct
  public void init() {
    uuid = UUID.randomUUID().toString();
    System.out.println("[" + uuid + "] request scope bean create: " + this);
  }

  @PreDestroy
  public void close() {
    System.out.println("[" + uuid + "] request scope bean close: " + this);
  }
}
```

```java

@Controller
@RequiredArgsConstructor
public class LogDemoController {

  private final LogDemoService logDemoService;
  private final MyLogger myLogger;

  @RequestMapping("log-demo")
  @ResponseBody
  public String logDemo(HttpServletRequest request) {
    String requestURL = request.getRequestURL().toString();
    myLogger.setRequestURL(requestURL);
    myLogger.log("controller test");
    logDemoService.logic("testId");

    return "OK";
  }
}
```

```java

@Service
@RequiredArgsConstructor
public class LogDemoService {

  private final MyLogger myLogger;

  public void logic(String id) {
    myLogger.log("service id = " + id);
  }
}
```

1. `log-demo`ë¡œ ìš”ì²­
2. ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¡œê¹… ì°ìŒ
3. ì„œë¹„ìŠ¤ì—ì„œ ë¡œê¹… ì°ìŒ
4. ì´ ë‘˜ì€ ê°™ì€ `request` ìŠ¤ì½”í”„ë¥¼ ê°€ì§€ë¯€ë¡œ ê°™ì€ `UUID`ë¥¼ ê°€ì§

ì´ë ‡ê²Œ ì˜ˆìƒí•˜ê³  ì‹¤í–‰ì„ ì‹œì¼œë³´ë©´ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.

ê·¸ ì´ìœ ëŠ” `MyLogger`ëŠ” ìš”ì²­ì´ ë“¤ì–´ì™€ì•¼ ìƒì„±ë˜ëŠ” ê°ì²´ì¸ë° ìŠ¤í”„ë§ì„ ë„ìš°ëŠ” ì‹œì ì—ëŠ” ìƒì„±ë˜ì–´ ìˆì§€ ì•Šìœ¼ë‹ˆ ì˜ì¡´ ì£¼ì…ì„ í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

#### ìŠ¤ì½”í”„ì™€ Provider

ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ì„œë¹„ìŠ¤ì—ì„œ `MyLogger` í•„ë“œë¥¼ `ObjectProvider<MyLogger>`ë¡œ ìˆ˜ì •í•˜ê³ ,
`ObjectProvider.getObject()`ë¥¼ í†µí•´ `MyLogger` í˜¸ì¶œí•˜ë„ë¡ ìˆ˜ì • í›„
ì‹¤í–‰ í•´ë³´ë©´ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰í•˜ë©´ ì •ìƒ ë™ì‘í•©ë‹ˆë‹¤.

```java

@Service
@RequiredArgsConstructor
public class LogDemoService {

  private final ObjectProvider<MyLogger> myLoggerProvider;

  public void logic(String id) {
    MyLogger myLogger = myLoggerProvider.getObject();
    myLogger.log("service id = " + id);
  }
}
```

- `ObjectProvider.getObject()`ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‹œì ê¹Œì§€ `request.scope`ë¹ˆì˜ ìƒì„±ì„ ì§€ì—°í•  ìˆ˜ ìˆìŒ
- `ObjectProvider.getObject()`ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‹œì ì—ëŠ” `HTTP` ìš”ì²­ì´ ì§„í–‰ì¤‘ì´ë¯€ë¡œ `request scope`ë¹ˆì˜ ìƒì„±ì´ ì •ìƒ ì²˜ë¦¬ ë¨

#### ìŠ¤ì½”í”„ì™€ í”„ë¡ì‹œ

ObjectProviderë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë°”ë¡œ MyLoggerë¥¼ ì‚¬ìš©í•˜ê²Œ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

```java

@Component
@Scope(value = "request", proxyMode = ScopedProxyMode.TARGET_CLASS)
public class MyLogger {
}
```

- `proxyMode` = `ScopedProxyMode.TARGET_CLASS`ë¥¼ ì¶”ê°€
  - ì ìš© ëŒ€ì„±ì´ í´ë˜ìŠ¤ë©´ `TARGET_CLASS`
  - ì ìš© ëŒ€ìƒì´ ì¸í„°í˜ì´ìŠ¤ë©´ `INTERFACES`
- ì´ë ‡ê²Œ í•˜ë©´ `MyLogger`ì˜ ê°€ì§œ í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ ë‘ê³  `HTTP request`ì™€ ìƒê´€ ì—†ì´ ê°€ì§œ í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ë‹¤ë¥¸ ë¹ˆì— ë¯¸ë¦¬ ì£¼ì…í•´ ë‘˜ ìˆ˜ ìˆìŒ

```java

@Service
@RequiredArgsConstructor
public class LogDemoService {

  // í”„ë¡ì‹œ ê°ì²´ ì£¼ì…
  private final MyLogger myLogger;

  public void logic(String id) {
    myLogger.log("service id = " + id);
  }
}
```

##### ë™ì‘ ì›ë¦¬

- CGLIB ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë‚´ í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ì€ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ì£¼ì…
- ì´ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ìš”ì²­ì´ ì˜¤ë©´ ê·¸ë•Œ ë‚´ë¶€ì—ì„œ ì‹¤ì œ ë¹ˆì„ ìš”ì²­í•˜ëŠ” ìœ„ì„ ë¡œì§ì´ ë“¤ì–´ ìˆìŒ
- ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ `request scope`ì™€ëŠ” ê´€ê³„ê°€ ì—†ìŒ. ê·¸ëƒ¥ ê°€ì§œì´ê³  ë‚´ë¶€ì— ë‹¨ìˆœí•œ ìœ„ì„ ë¡œì§ë§Œ ìˆê³ , ì‹±ê¸€í†¤ ì²˜ëŸ¼ ë™ì‘ í•¨

![](/assets/img/_posts/2025/11/2025-11-03-ë¹ˆ-ìŠ¤ì½”í”„/309830144574250.png)

## ì°¸ê³ 

- [https://www.inflearn.com/course/ìŠ¤í”„ë§-í•µì‹¬-ì›ë¦¬-ê¸°ë³¸í¸](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%ED%95%B5%EC%8B%AC-%EC%9B%90%EB%A6%AC-%EA%B8%B0%EB%B3%B8%ED%8E%B8)
