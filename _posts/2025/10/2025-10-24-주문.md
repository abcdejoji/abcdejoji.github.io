---
title: "주문"
categories: [ "Backend" ]
tags: [ "[인프런] 제미니 개발실무 - 커머스 백엔드 기본편" ]
date: "2025-10-24 01:22:00"
---

## 요구사항

![](/assets/img/posts/2025/10/2025-10-24-주문/196695588383583.png)

## 요구사항 더 캐묻기

- 쿠폰은 여러 개가 사용 가능한건지?
- 쿠폰 사용 시, 최소 주문 금액이 있는지?
- 쿠폰이 상품 두 개 다 사용이 가능할 때, 어떤 상품에 적용 가능하게 할 것 인지?
  - 유저가 선택 가능하게 할 것인지?
- 포인트는 최소 주문 금액이 있는지?
- 배송이 따로 일 경우 배송비는 어떻게 하는지?
- 배송 주소는 어디서 입력 받는지?
- 재고 수량이 부족한 경우 결제 클릭 시, 예외가 발생해야 하는지?
- 결제 예외가 발생할 시, 어떻게 처리할 지?

## 구현 시, 고려사항

- 결제 전, 주문을 만들면 쓰레기 데이터가 될 수 있음
- 결제 시, 주문을 만들면 결제 로직 중 오류가 발생하면 주문이 휘발 될 수 있음

## 흐름도

![](/assets/img/posts/2025/10/2025-10-24-주문/197229001235791.png)

- 상품이나, 장바구니에서 주문이 가능

### 주문 흐름을 하나로 만들어 보기

- 상품 주문 시, 장바구니에 담아서 주문을 만드는 식으로 장바구니를 통해서만 주문 되도록 흐름을 만들 수 있음
- 반대로, 여러 상품을 주문하는 식으로 만들어 장바구니에 담은 상품을 상품 여러 개로 주문 되도록 흐름을 만들 수 있음
- 주문이 상품을 의존하느냐, 장바구니를 의존하느냐의 차이

## OrderId가 있는데 OrderKey를 별도로 만드는 이유

- 경쟁사에서 주문 개수를 유추할 수 있음
- `OrderId`로 할 시, 해커가 순회하며 주문 요청을 보낼 수도 있음 (유저 정보를 체크하니 상관은 없을 듯)
- 등등

## API

### 상품 주문

```bash
POST /v1/orders
```

| Parameter | 설명        |
|-----------|-----------|
| productId | 상품 고유 아이디 |
| quantity  | 수량        |

1. `상품id`로 상품 조회
2. `주문 엔티티` 생성 및 저장
3. `주문 항목 엔티티` 생성 및 저장
4. `주문 키` 반환

### 장바구니에서 주문

```bash
POST /v1/cart-orders
```

| Parameter   | 설명                  |
|-------------|---------------------|
| cartItemIds | 장바구니 아이템 고유 아이디 리스트 |

1. `장바구니 항목` 조회
2. 파라미터로 전달받은 `장바구니 항목`만 필터링 해서 `주문` 생성
3. `상품 주문 서비스` 호출

### 결제 전 주문 화면

```bash
GET /v1/orders/{orderKey}/checkout
```

| Path Parameter | 설명   |
|----------------|------|
| orderKey       | 주문 키 |

1. `주문 키` 및 `CREATE 상태`에 해당하는 주문 조회
2. 사용 가능한 `쿠폰` 조회
3. `포인트` 잔액 조회

### 주문 목록 조회

```bash
GET /v1/orders
```

- `결제 완료`된 `주문` 목록 조회

### 주문 상세 조회

```bash
GET /v1/orders/{orderKey}
```

| Path Parameter | 설명   |
|----------------|------|
| orderKey       | 주문 키 |

1. `주문 키`에 해당하는 `주문` 조회
2. `주문`에 해당하는 `주문 항목` 조회

## 개념도

![](/assets/img/posts/2025/10/2025-10-24-주문/199224861393583.png)

- 주문은 상품을 의존
- 장바구니로 주문 시, 상품을 여러 개 주문하는 식으로 구현하였기에 장바구니가 상품에 의존
- 상품이 장바구니에 비해 상급 개념이라 상품을 메인으로 놓고 처리한 것

## 참고

- [https://www.inflearn.com/course/제미니의-개발실무-커머스-백엔드-기본](https://www.inflearn.com/course/%EC%A0%9C%EB%AF%B8%EB%8B%88%EC%9D%98-%EA%B0%9C%EB%B0%9C%EC%8B%A4%EB%AC%B4-%EC%BB%A4%EB%A8%B8%EC%8A%A4-%EB%B0%B1%EC%97%94%EB%93%9C-%EA%B8%B0%EB%B3%B8)
