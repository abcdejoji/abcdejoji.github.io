---
title: "ë©”ëª¨ë¦¬ ê°€ì‹œì„±"
categories: [ "Java & Spring" ]
tags: [ "[ì¸í”„ëŸ°] ê¹€ì˜í•œì˜ ì‹¤ì „ ìë°” - ê³ ê¸‰ 1í¸" ]
date: "2025-09-21 00:25:00"
---

## ë©”ëª¨ë¦¬ ê°€ì‹œì„±(memory visibility)ì´ë€?

- ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ í•œ ìŠ¤ë ˆë“œê°€ ë³€ê²½í•œ ê°’ì´ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì–¸ì œ ë³´ì´ëŠ”ì§€ì— ëŒ€í•œ ê²ƒ

## ìŠ¤ë ˆë“œê°„ ë³€ìˆ˜ ë³€ê²½ ì‹œ ì ìš© ì•ˆë˜ëŠ” ìƒí™©

```java
public class VolatileFlagMain {

  public static void main(String[] args) {
    MyTask task = new MyTask();
    Thread thread = new Thread(task, "work");
    log("runFlag = " + task.runFlag);
    thread.start();

    sleep(1000);

    log("runFlagë¥¼ falseë¡œ ë³€ê²½ ì‹œë„");
    task.runFlag = false;
    log("runFlag = " + task.runFlag);
    log("main ì¢…ë£Œ");
  }

  static class MyTask implements Runnable {

    boolean runFlag = true;

    @Override
    public void run() {
      log("task ì‹œì‘");
      while (runFlag) {
        // runFlagê°€ falseë¡œ ë³€í•˜ë©´ íƒˆì¶œ
      }
      log("task ì¢…ë£Œ");
    }
  }
}
```

ìœ„ ì½”ë“œë¥¼ ì‹¤í–‰í•´ë³´ë©´ `task.runFlag` ê°’ì´ `false`ë¡œ ì¶œë ¥ ë¨ì—ë„ `MyTask`ëŠ” ê³„ì† ì‹¤í–‰ë˜ê³  ìˆì–´ í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ê·¸ ì´ìœ ëŠ” ìŠ¤ë ˆë“œ ë³„ë¡œ ë³€ìˆ˜ë¥¼ ìºì‹œ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

## ë©”ëª¨ë¦¬ ì ‘ê·¼ ë°©ì‹

### ì¼ë°˜ì ìœ¼ë¡œ ìƒê°í•˜ëŠ” ë©”ëª¨ë¦¬ ì ‘ê·¼ ë°©ì‹

![](/assets/img/posts/2025/2025-09-21-ë©”ëª¨ë¦¬-ê°€ì‹œì„±/711793279485208.png)

### ì‹¤ì œ ë©”ëª¨ë¦¬ ì ‘ê·¼ ë°©ì‹

![](/assets/img/posts/2025/2025-09-21-ë©”ëª¨ë¦¬-ê°€ì‹œì„±/711801582076791.png)

> ğŸ’¡ ìºì‹œ ë©”ëª¨ë¦¬ <-> ë©”ì¸ ë©”ëª¨ë¦¬

ì„œë¡œ ê°’ì„ ë°˜ì˜í•˜ëŠ” íƒ€ì´ë°ì€ ì¼ë°˜ì ìœ¼ë¡œ ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ì´ ì¼ì–´ë‚  ë•Œì´ì§€ë§Œ ì´ê²ƒë„ ë³´ì¥ë˜ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.

## ë©”ì¸ ë©”ëª¨ë¦¬ì— ë°”ë¡œ ì ‘ê·¼ - volatile

ë³€ìˆ˜ ì•ì— `volatile` í‚¤ì›Œë“œë¥¼ ì“°ë©´ ë©”ì¸ ë©”ëª¨ë¦¬ì— ë°”ë¡œ ì ‘ê·¼ í•˜ëŠ” ë³€ìˆ˜ê°€ ë©ë‹ˆë‹¤.

```java
public class VolatileFlagMain {

  public static void main(String[] args) {
    MyTask task = new MyTask();
    Thread thread = new Thread(task, "work");
    log("runFlag = " + task.runFlag);
    thread.start();

    sleep(1000);

    log("runFlagë¥¼ falseë¡œ ë³€ê²½ ì‹œë„");
    task.runFlag = false;
    log("runFlag = " + task.runFlag);
    log("main ì¢…ë£Œ");
  }

  static class MyTask implements Runnable {

    // volatile ì¶”ê°€
    volatile boolean runFlag = true;

    @Override
    public void run() {
      log("task ì‹œì‘");
      while (runFlag) {
        // runFlagê°€ falseë¡œ ë³€í•˜ë©´ íƒˆì¶œ
      }
      log("task ì¢…ë£Œ");
    }
  }
}

```

ì´ì œ ë‘ ìŠ¤ë ˆë“œ ëª¨ë‘ ë©”ì¸ ë©”ëª¨ë¦¬ì— ìˆëŠ” `runFlag` ê°’ì„ ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì— ì •ìƒì ìœ¼ë¡œ ë¡œì§ì´ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> `volatile`ëŠ” ë©”ì¸ ë©”ëª¨ë¦¬ì— ë°”ë¡œ ì ‘ê·¼ í•˜ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ ì €í•˜ê°€ ìˆìŠµë‹ˆë‹¤.

## ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸(Java Memory Model)

- ìë°” í”„ë¡œê·¸ë¨ì´ ì–´ë–»ê²Œ ë©”ëª¨ë¦¬ì— ì ‘ê·¼í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ê·œì •

### happens-before

- JMMì—ì„œ ìŠ¤ë ˆë“œ ê°„ì˜ ì‘ì—… ìˆœì„œë¥¼ ì •ì˜í•˜ëŠ” ê°œë…

### ê·œì¹™

- í•œ ë™ì‘ì´ ë‹¤ë¥¸ ë™ì‘ë³´ë‹¤ ë¨¼ì € ë°œìƒí•¨ì„ ë³´ì¥
- ìŠ¤ë ˆë“œ ê°„ì˜ ë©”ëª¨ë¦¬ ê°€ì‹œì„±ì„ ë³´ì¥í•˜ëŠ” ê·œì¹™
- happens-before ê´€ê³„ê°€ ì„±ë¦½í•˜ë©´, í•œ ìŠ¤ë ˆë“œì˜ ì‘ì—…ì„ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ë³¼ìˆ˜ ìˆê²Œ ë¨
  - ì¦‰, í•œ ìŠ¤ë ˆë“œì—ì„œ ìˆ˜í–‰í•œ ì‘ì—…ì„ ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì°¸ì¡°í•  ë•Œ ìµœì‹  ìƒíƒœê°€ ë³´ì¥ ë¨

### happens-before ê´€ê³„ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°

- í”„ë¡œê·¸ë¨ ìˆœì„œ ê·œì¹™
  - ìˆœì„œëŒ€ë¡œ ì‘ì„±ëœ ëª¨ë“  ëª…ë ¹ë¬¸ì€ happens-before ìˆœì„œë¡œ ì‹¤í–‰
- volatile ë³€ìˆ˜ ê·œì¹™
  - `volatile` ë³€ìˆ˜ì— ëŒ€í•œ ì“°ê¸° ì‘ì—…ì€ ê·¸ ë³€ìˆ˜ë¥¼ ì½ëŠ” ì‘ì—…ë³´ë‹¤ happens-before ê´€ê³„ë¥¼ í˜•ì„±
- ìŠ¤ë ˆë“œ ì‹œì‘ ê·œì¹™
  - í•œ ìŠ¤ë ˆë“œì—ì„œ `Thread.start()`ë¥¼ í˜¸ì¶œí•˜ë©´, í•´ë‹¹ ìŠ¤ë ˆë“œ ë‚´ì˜ ëª¨ë“  ì‘ì—…ì€ `start()` í˜¸ì¶œ ì´í›„ì— ì‹¤í–‰ëœ ì‘ì—…ë³´ë‹¤ happens-before ê´€ê³„ê°€ ì„±ë¦½
- ìŠ¤ë ˆë“œ ì¢…ë£Œ ê·œì¹™
  - í•œ ìŠ¤ë ˆë“œì—ì„œ `Thread.join()`ì„ í˜¸ì¶œí•˜ë©´, `join` ëŒ€ìƒ ìŠ¤ë ˆë“œì˜ ëª¨ë“  ì‘ì—…ì€ `join()`ì´ ë°˜í™˜ëœ í›„ì˜ ì‘ì—… ë³´ë‹¤ happens-before ê´€ê³„ë¥¼ ê°€ì§
- ì¸í„°ëŸ½íŠ¸ ê·œì¹™
  - í•œ ìŠ¤ë ˆë“œì—ì„œ `Thread.interrupt()`ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‘ì—…ì´ ì¸í„°ëŸ½íŠ¸ëœ ìŠ¤ë ˆë“œê°€ ì¸í„°ëŸ½íŠ¸ë¥¼ ê°ì§€í•˜ëŠ” ì‹œì ì˜ ì‘ì—… ë³´ë‹¤ happens-before ê´€ê³„ê°€ ì„±ë¦½
- ê°ì²´ ìƒì„± ê·œì¹™
  - ê°ì²´ì˜ ìƒì„±ìì—ì„œ ì´ˆê¸°í™”ëœ í•„ë“œëŠ” ìƒì„±ìê°€ ì™„ë£Œëœ í›„ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì°¸ì¡°ë  ë•Œ happens-before ê´€ê³„ê°€ ì„±ë¦½
- ëª¨ë‹ˆí„° ë½ ê·œì¹™
  - í•œ ìŠ¤ë ˆë“œì—ì„œ `synchronized` ë¸”ë¡ì„ ì¢…ë£Œí•œ í›„, ê·¸ ëª¨ë‹ˆí„°ë½ì„ ì–»ëŠ” ëª¨ë“  ìŠ¤ë ˆë“œëŠ” í•´ë‹¹ ë¸”ë¡ ë‚´ì˜ ëª¨ë“  ì‘ì—…ì„ ë³¼ ìˆ˜ ìˆìŒ
  - `ReentrantLock`ê³¼ ê°™ì´ ë½ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ë„ happens-before ê´€ê³„ê°€ ì„±ë¦½
- ì „ì´ ê·œì¹™
  - Aê°€ Bë³´ë‹¤ happens-before ê´€ê³„ì— ìˆê³ , Bê°€ Aë³´ë‹¤ happens-before ê´€ê³„ì— ìˆë‹¤ë©´, AëŠ” Cë³´ë‹¤ happens-before ê´€ê³„ì— ìˆìŒ
  - ì¦‰, `(A > B, B > C = A > C)`

> ğŸ’¡ í•œì¤„ ìš”ì•½

`volatile` ë˜ëŠ” `ìŠ¤ë ˆë“œ ë™ê¸°í™” ê¸°ë²•(synchronized, ReentrantLock)`ì„ ì‚¬ìš©í•˜ë©´ ë©”ëª¨ë¦¬ ê°€ì‹œì„± ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

## ì°¸ê³ 

- [https://www.inflearn.com/course/ê¹€ì˜í•œì˜-ì‹¤ì „-ìë°”-ê³ ê¸‰-1](https://www.inflearn.com/course/%EA%B9%80%EC%98%81%ED%95%9C%EC%9D%98-%EC%8B%A4%EC%A0%84-%EC%9E%90%EB%B0%94-%EA%B3%A0%EA%B8%89-1)
